## 进程描述

### 程序和进程

程序是包含一系列信息的文件，这些信息描述了如何在运行时创建一个进程。

进程是正在运行的程序的实例。是一个具有一定独立功能的程序关于某个数据集合的 一次运行活动。

### 单道、多道程序设计

单道程序，即在计算机内存中只允许一个的程序运行。

多道程序设计技术是在计算机内存中同时存放几道相互独立的程序，使它们在管理程 序控制下，相互穿插运行，两个或两个以上程序在计算机系统中同处于开始到结束之 间的状态, 这些程序共享计算机系统资源。

> 任意时刻，单个CPU上运行的程序只有一个。在多道程序设计当中，多个进程轮流使用CPU，但是由于切换速度极快，所以看似是同时运行。

### 时间片

又称“量子”、“处理器片”，是操作系统分配给每个正在运行的进程微观上的一段 CPU 时间。

时间片由操作系统内核的调度程序分配给每个进程。首先，内核会给每个进程分配相等 的初始时间片，然后每个进程轮番地执行相应的时间，当所有进程都处于时间片耗尽的状态时，内核会重新为每个进程计算并分配时间片，如此往复

### 并行和并发

并行(parallel)：指在同一时刻，有多条指令在**多个**处理器上同时执行。 

并发(concurrency)：指在同一时刻只能有一条指令执行，但多个进程指令被快速的 轮换执行，使得在宏观上具有多个进程同时执行的效果，但在微观上并不是同时执行的，只是把时间分成若干段，使多个进程快速交替的执行。

> 并行：两个队伍，排两个窗口。
>
> 并发：两个队伍，交叉排同一个窗口。

### 进程控制块

为了管理进程，内核必须对每个进程所做的事情进行清楚的描述。内核为每个进程分 配一个 PCB(Processing Control Block)进程控制块，维护进程相关的信息，Linux 内核的进程控制块是 task_struct **结构体**。

结构体中有很多内部成员，主要掌握以下信息：

进程的id、状态、切换时需要保存和恢复的一些CPU寄存器信息、虚拟地址空间信息、控制终端的信息等。

## 进程状态转换

### 进程的状态

![image-20221016194417722](http://pic.shixiaocaia.fun/202210161944937.png)

**三态**

运行态：进程占有处理器正在运行 

就绪态：进程具备运行条件，等待系统分配处理器以便运行。当进程已分配到除CPU以外的所有必要资源后，只要再 获得CPU，便可立即执行。在一个系统中处于就绪状态的进 程可能有多个，通常将它们排成一个队列，称为就绪队列。

阻塞态：又称为等待(wait)态或睡眠(sleep)态，指进程不具备运行条件，正在等待某个事件的完成。

**五态**

新建态：进程刚被创建时的状态，尚未进入就绪队列。

终止态：进程完成任务到达正常结束点，或出现无法克服的错误而异常终止，或被操作系统及 有终止权的进程所终止时所处的状态。

进入终止态的进程以后不再执行，但依然保留在操作系统中等待善后。一旦其他进程完成了对终止态进程的信息抽取之后，操作系统将删除该进程。

### 进程相关的命令

```shell
# 查看进程的相关命令
ps aux / ajx 
a：显示终端上的所有进程，包括其他用户的进程 

u：显示进程的详细信息 

x：显示没有控制终端的进程

j：列出与作业控制相关的信息

# STAT参数意义：
D 不可中断 Uninterruptible（usually IO） 
R 正在运行，或在队列中的进程
S(大写) 处于休眠状态 
T 停止或被追踪
Z 僵尸进程
W 进入内存交换（从内核2.6开始无效）
X 死掉的进程 
< 高优先级 
> 低优先级
s 包含子进程
+ 位于前台的进程组
 
# 实时显示进程动态 top
可以在使用 top 命令时加上 -d 来指定显示信息更新的时间间隔，在 top 命令 执行后，可以按以下按键对显示的结果进行排序：
M 根据内存使用量排序 
P 根据 CPU 占有率排序 
T 根据进程运行时间长短排序 
U 根据用户名来筛选进程
K 输入指定的 PID 杀死进程

# 杀死进程
kill [-signal] pid 
kill –l 列出所有信号 
kill –SIGKILL 进程ID 
kill -9 进程ID

killall name 根据进程名杀死进程
```

**进程号**

每个进程都由进程号来标识，其类型为 pid_t（整型），进程号的范围：0～32767。 进程号总是唯一的，但可以重用。当一个进程终止后，其进程号就可以再次使用。

任何进程（除 init 进程）都是由另一个进程创建，该进程称为被创建进程的父进程， 对应的进程号称为父进程号（PPID）。

进程组是一个或多个进程的集合。他们之间相互关联，进程组可以接收同一终端的各 种信号，关联的进程有一个进程组号（PGID）。默认情况下，当前的进程号会当做当 前的进程组号。

进程号和进程组相关函数：

- pid_t  getpid(void); 
- pid_t  getppid(void);
- pid_t  getpgid(pid_t pid);
