## 运输层概述

运输层作为OSI体系结构自下而上的第四层，其主要任务是为相互通信的应用进程提供逻辑通信服务，为运行在不同主机上的应用进程提供直接的逻辑通信服务。

> 上一层网络层提供主机之间的逻辑通信，实现主机到主机。
>
> 然而在计算机网络中实际进行通信的真正实体是位于通信两端主机的进程。

运输层的协议又称为端到端的协议，因为运输层的作用范围是应用进程到应用进程。

运输层向应用层实体屏蔽了下面网络核心的细节（例如网络拓扑、所采用的路由选择协议等），它使应用进程看见的就**好像是在两个运输层实体之间有一条端到端的逻辑通信信道。**

根据应用需求的不同，因特网的运输层为应用层提供了两种不同的运输层协议，即面向连接的TCP和无连接的UDP。

> 在网际层，网际层为主机提供逻辑通信服务，是一种尽最大努力的数据报服务，可能会出现各种错误，但是对于实时性要求高的服务，这是可以忽略的。
>
> 而对于电子邮件、文件传输等需要可靠传输通信的服务，需要使用TCP/ IP体系结构的运输层太提供可靠服务。

### 用户数据报协议 UDP

用户数据报协议(User Datagram Protocol,UDP)为其上层提供的是**无连接**的**不可靠**的数据传输服务。

使用UDP通信的双方，在传送数据之前不需要建立连接。

UDP不需要实现可靠传输，因此不需要使用实现可靠传输的各种机制。

UDP的实现简单，UDP用户数据报的首部比较小。

### 传输控制协议 TCP

传输控制协议(Transmission Control Protocol,,TCP)为其上层提供的是**面向连接**的**可靠**的数据传输服务。

使用TCP通信的双方，在传送数据之前必须首先**建立TCP连接**(逻辑连接，而非物理连接)。数据传输结束后必须要**释放TCP连接**。

TCP为了实现可靠传输，就必须使用很多措施，例如TCP连接管理、确认机制、超时重传、流量控制以及拥塞控制等。

TCP的实现复杂，TCP报文段的首部比较大，占用处理机资源比较多。

### 运输层端口号

运行在计算机上的进程是使用进程标识符（Process Identification，PID）来标识的。

TCP/IP体系结构的运输层使用端口号来标识和区分应用层的不同应用进程。端口号的长度为16比特，取值范围是0~65535。

**熟知端口号**

![image-20221106161553455](http://pic.shixiaocaia.fun/202211061616500.png)

> 端口号只具有本地意义，即端口号只是为了标识本计算机网络协议栈应用层中的各应用进程。在因特网中，不同计算机中的相同端口号是没有关系的，即相互独立。另外，TCP和UDP端口号之间也是没有关系的。

**发送方的复用和接收方的分用**

发送方的某些应用进程所发送的不同应用报文，在运输层使用UDP协议进行封装，称为UDP复用，在运输层使用TCP协议进行封装，称为TCP复用。

到网际层都需要使用IP协议封装成IP数据报，称为IP复用。在IP数据报中协议字段来表示封装的是何种协议数据单元。

---

接收端的网际层收到IP数据报进行IP分用。协议字段是17（UDP用户数据报），交给运输层的UDP，同样是TCP交给TCP处理。

运输层堆UDP用户数据报进行UDP分用，对TCP报文段进行TCP分用。根据其中的目的端口号，向上交付给应用层的相应进程。

