## 线程池分析

线程池的设计模式为半同步/半反应堆，其中反应堆具体为Proactor事件处理模式。

具体的，主线程为异步线程，负责监听文件描述符，接收socket新连接，若当前监听的socket发生了读写事件，然后将任务插入到请求队列。工作线程从请求队列中取出任务，完成读写数据的处理。

## 问题

1. `pthread_create(m_threads + i, NULL, worker, this)`

> worker如果是一个普通的类成员函数，那么自带的默认参数this指针，和函数原型的`void *`冲突了。

## 函数实现

**线程池创建与回收**

> 初始化线程池。
>
> 构造函数中创建线程池,pthread_create函数中将类的对象作为参数传递给静态函数(worker),在静态函数中引用这个对象,并调用其动态方法(run)。
>
> 具体的，类对象传递时用this指针，传递给静态函数后，将其转换为线程池类，并调用私有成员函数run。

**析构**

> 释放线程池。

**向请求任务队列插入请求**

> 通过list容器创建请求队列，向队列中添加时，通过互斥锁保证线程安全，添加完成后通过信号量提醒有任务要处理，最后注意线程同步。

**线程处理函数**

> 内部访问私有成员函数run，完成线程处理要求。

**run执行任务**

> 主要实现，工作线程从请求队列中取出某个任务进行处理，注意线程同步。